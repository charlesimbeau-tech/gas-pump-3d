<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Realistic 3D Gas Pump</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b0f17; }
    #c { width: 100%; height: 100%; display: block; touch-action: none; }
    .hud {
      position: fixed; left: 12px; bottom: 12px; right: 12px;
      font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: rgba(255,255,255,.88);
      background: rgba(0,0,0,.38);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      max-width: 620px;
      margin: 0 auto;
    }
    .topbar {
      position: fixed; left: 12px; top: 12px; right: 12px;
      display: flex; gap: 8px; align-items: center;
      max-width: 620px;
      margin: 0 auto;
      z-index: 5;
    }
    .badge {
      font: 12px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: rgba(255,255,255,.92);
      background: rgba(120,80,255,.22);
      border: 1px solid rgba(160,120,255,.32);
      padding: 6px 10px;
      border-radius: 999px;
    }
    #debug {
      position: fixed; left: 12px; right: 12px; top: 60px;
      max-width: 620px; margin: 0 auto;
      color: #fff;
      background: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      font: 12px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      white-space: pre-wrap;
      z-index: 10;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="topbar">
    <div class="badge"><b>Realistic 3D Gas Pump</b> — drag to orbit, pinch to zoom</div>
  </div>
  <div id="debug">Loading…</div>
  <div class="hud">
    Mobile: <b>1 finger</b> rotate · <b>2 fingers</b> pan · <b>pinch</b> zoom.
  </div>

  <!-- Babylon.js (non-module) for maximum mobile compatibility -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>

  <script>
    (function () {
      const debug = document.getElementById('debug');
      function setDebug(t){ debug.textContent = t; }

      try {
        const canvas = document.getElementById('c');
        const engine = new BABYLON.Engine(canvas, true, {
          preserveDrawingBuffer: true,
          stencil: true,
          disableWebGL2Support: false,
        });

        const scene = new BABYLON.Scene(engine);
        scene.clearColor = new BABYLON.Color4(0.043, 0.059, 0.090, 1);

        // Camera
        const camera = new BABYLON.ArcRotateCamera('cam', -Math.PI/2.2, Math.PI/3, 6.0, new BABYLON.Vector3(0, 1.2, 0), scene);
        camera.attachControl(canvas, true);
        camera.lowerRadiusLimit = 2.2;
        camera.upperRadiusLimit = 12;
        camera.panningSensibility = 1200;
        camera.wheelPrecision = 50;

        // Lights
        const hemi = new BABYLON.HemisphericLight('hemi', new BABYLON.Vector3(0, 1, 0), scene);
        hemi.intensity = 0.85;
        hemi.groundColor = new BABYLON.Color3(0.05, 0.06, 0.08);

        const key = new BABYLON.DirectionalLight('key', new BABYLON.Vector3(-0.6, -1, -0.4), scene);
        key.position = new BABYLON.Vector3(6, 10, 6);
        key.intensity = 1.35;

        // Ground
        const ground = BABYLON.MeshBuilder.CreateGround('ground', { width: 30, height: 30 }, scene);
        const groundMat = new BABYLON.PBRMaterial('groundMat', scene);
        groundMat.albedoColor = new BABYLON.Color3(0.06, 0.08, 0.13);
        groundMat.roughness = 1.0;
        groundMat.metallic = 0.0;
        ground.material = groundMat;

        // Materials
        const paintRed = new BABYLON.PBRMaterial('paintRed', scene);
        paintRed.albedoColor = new BABYLON.Color3(0.82, 0.16, 0.16);
        paintRed.metallic = 0.3;
        paintRed.roughness = 0.35;
        paintRed.clearCoat.isEnabled = true;
        paintRed.clearCoat.intensity = 0.35;

        const paintDeepRed = new BABYLON.PBRMaterial('paintDeepRed', scene);
        paintDeepRed.albedoColor = new BABYLON.Color3(0.62, 0.12, 0.12);
        paintDeepRed.metallic = 0.28;
        paintDeepRed.roughness = 0.38;
        paintDeepRed.clearCoat.isEnabled = true;
        paintDeepRed.clearCoat.intensity = 0.25;

        const darkMetal = new BABYLON.PBRMaterial('darkMetal', scene);
        darkMetal.albedoColor = new BABYLON.Color3(0.16, 0.20, 0.28);
        darkMetal.metallic = 0.85;
        darkMetal.roughness = 0.40;

        const rubber = new BABYLON.PBRMaterial('rubber', scene);
        rubber.albedoColor = new BABYLON.Color3(0.07, 0.09, 0.12);
        rubber.metallic = 0.02;
        rubber.roughness = 0.95;

        const plastic = new BABYLON.PBRMaterial('plastic', scene);
        plastic.albedoColor = new BABYLON.Color3(0.07, 0.09, 0.14);
        plastic.metallic = 0.04;
        plastic.roughness = 0.70;

        const steel = new BABYLON.PBRMaterial('steel', scene);
        steel.albedoColor = new BABYLON.Color3(0.70, 0.74, 0.80);
        steel.metallic = 0.95;
        steel.roughness = 0.35;

        const glass = new BABYLON.PBRMaterial('glass', scene);
        glass.albedoColor = new BABYLON.Color3(0.25, 0.75, 0.95);
        glass.metallic = 0.0;
        glass.roughness = 0.08;
        glass.alpha = 0.55;

        // Pump group
        const pump = new BABYLON.TransformNode('pump', scene);

        // Base pad
        const basePad = BABYLON.MeshBuilder.CreateBox('basePad', { width: 1.16, height: 0.06, depth: 0.96 }, scene);
        basePad.position.y = 0.03;
        basePad.parent = pump;
        basePad.material = rubber;

        const baseSkirt = BABYLON.MeshBuilder.CreateBox('baseSkirt', { width: 1.12, height: 0.16, depth: 0.92 }, scene);
        baseSkirt.position.y = 0.06 + 0.08;
        baseSkirt.parent = pump;
        baseSkirt.material = darkMetal;

        // Body
        const body = BABYLON.MeshBuilder.CreateBox('body', { width: 0.92, height: 1.55, depth: 0.72 }, scene);
        body.position.y = 0.22 + 1.55/2;
        body.parent = pump;
        body.material = paintRed;

        // Side column
        const side = BABYLON.MeshBuilder.CreateBox('side', { width: 0.16, height: 1.55, depth: 0.72 }, scene);
        side.position.set(0.54, body.position.y, 0);
        side.parent = pump;
        side.material = paintDeepRed;

        // Cap
        const cap = BABYLON.MeshBuilder.CreateBox('cap', { width: 1.02, height: 0.18, depth: 0.78 }, scene);
        cap.position.y = 0.22 + 1.55 + 0.09;
        cap.parent = pump;
        cap.material = paintDeepRed;

        // Bezel + screen
        const bezel = BABYLON.MeshBuilder.CreateBox('bezel', { width: 0.64, height: 0.52, depth: 0.06 }, scene);
        bezel.position.set(0, 0.22 + 1.08, 0.36);
        bezel.parent = pump;
        bezel.material = plastic;

        const screen = BABYLON.MeshBuilder.CreateBox('screen', { width: 0.54, height: 0.36, depth: 0.012 }, scene);
        screen.position.set(0, 0.02, 0.037);
        screen.parent = bezel;
        screen.material = glass;

        // Keypad
        const keypad = BABYLON.MeshBuilder.CreateBox('keypad', { width: 0.54, height: 0.42, depth: 0.05 }, scene);
        keypad.position.set(0, 0.22 + 0.70, 0.35);
        keypad.parent = pump;
        keypad.material = plastic;

        for (let r=0; r<4; r++) {
          for (let c=0; c<3; c++) {
            const b = BABYLON.MeshBuilder.CreateBox('b'+r+c, { width: 0.10, height: 0.06, depth: 0.03 }, scene);
            b.position.set(-0.14 + c*0.14, 0.12 + r*0.09, 0.03);
            b.parent = keypad;
            b.material = new BABYLON.PBRMaterial('btnMat', scene);
            b.material.albedoColor = new BABYLON.Color3(0.92, 0.94, 0.98);
            b.material.metallic = 0.08;
            b.material.roughness = 0.35;
          }
        }

        // Nozzle + hose (simplified)
        const holster = BABYLON.MeshBuilder.CreateBox('holster', { width: 0.16, height: 0.32, depth: 0.28 }, scene);
        holster.position.set(0.60, 0.22 + 0.86, 0.22);
        holster.parent = pump;
        holster.material = plastic;

        const handle = BABYLON.MeshBuilder.CreateBox('handle', { width: 0.08, height: 0.22, depth: 0.07 }, scene);
        handle.position.set(0.64, 0.22 + 0.78, 0.22);
        handle.parent = pump;
        handle.material = darkMetal;

        const spout = BABYLON.MeshBuilder.CreateCylinder('spout', { diameterTop: 0.024, diameterBottom: 0.036, height: 0.24, tessellation: 20 }, scene);
        spout.rotation.z = Math.PI/2;
        spout.position.set(0.52, 0.22 + 0.86, 0.22);
        spout.parent = pump;
        spout.material = steel;

        const hose = BABYLON.MeshBuilder.CreateTube('hose', {
          path: [
            new BABYLON.Vector3(0.64, 0.22 + 0.75, 0.16),
            new BABYLON.Vector3(1.00, 0.22 + 0.60, 0.04),
            new BABYLON.Vector3(0.86, 0.22 + 0.30, -0.18),
            new BABYLON.Vector3(0.52, 0.22 + 0.18, -0.10),
          ],
          radius: 0.02,
          tessellation: 12,
        }, scene);
        hose.parent = pump;
        hose.material = rubber;

        // Subtle idle rotation
        scene.onBeforeRenderObservable.add(() => {
          pump.rotation.y = Math.sin(performance.now() * 0.00022) * 0.06;
        });

        setDebug('OK: Babylon loaded. UA: ' + navigator.userAgent);
        setTimeout(() => { debug.style.display = 'none'; }, 1600);

        engine.runRenderLoop(() => scene.render());
        window.addEventListener('resize', () => engine.resize());
      } catch (err) {
        setDebug('JS ERROR:\n\n' + (err && (err.stack || err.message) ? (err.stack || err.message) : String(err)));
        console.error(err);
      }
    })();
  </script>
</body>
</html>
